<div id="blabbr-version-history">
  <div id="blabbr-version-history-dropdown">
    <span id="blabbr-version-history-dropdown-top"></span>
    <div id="blabbr-version-history-dropdown-content">
      <p>Hello World!</p>
    </div>
  </div>
</div>

<script>
const versionHistoryLinks = document.getElementById('blabbr-version-history');
const path = window.parent.location.pathname;
const currentVersion = path.substr(1, path.length - 2);

const processVersions = data => {
  const url = window.parent.location;

  data.reverse().forEach((version) => {
    if (version === currentVersion) {
      const topView = document.getElementById('blabbr-version-history');
      // No link
      const el = ocument.createElement('strong');
      el.appendChild(document.createTextNode(version));
      versionHistoryLinks.appendChild(el);
    } else {
      // Link :-)
      const link = document.createElement('a');
      const versionUrl = `${url.protocol}//${url.hostname}:${url.port}/${version}/${url.search}${url.hash}`;

      link.href = versionUrl;
      link.target = '_parent';
      link.appendChild(document.createTextNode(version));

      versionHistoryLinks.appendChild(link);
    }
  });
}

const getVersions = () => {
  const url = window.parent.location;
  const location = `${url.protocol}//${url.hostname}:${url.port}/versions.json`;

  fetch(location).then(response => {
    if (response.ok) {
      response.json().then(data => processVersions(data));
    }
  }).catch(() => {
    // Ignore. Maybe we want to remove the div?
  });
}

getVersions();
</script>
<style>
  html, body {
    padding: 0;
    margin: 0;
  }

  #blabbr-version-history {
    background: rgb(247, 247, 247);
    border-bottom: 1px solid rgb(236, 236, 236);
    padding: 2px 0.5em;
    color: rgb(68, 68, 68);
    font-family: -apple-system, ".SFNSText-Regular", "San Francisco",
      Roboto, "Segoe UI", "Helvetica Neue", "Lucida Grande", sans-serif;
    font-size: 15px;
  }

  #blabbr-version-history > a {
    display: inline-block;
    padding: 0.3em;
    border: 1px solid rgb(236, 236, 236);
    background: rgb(255, 255, 255);
    margin: 0 0.5em 0 0;
    text-decoration: none;
    color: rgb(68, 68, 68);
  }

  #blabbr-version-history > a:hover {
    background: rgb(236, 236, 236);
    text-decoration: underline;
  }

  #blabbr-version-history > a:visited {
    color: rgb(68, 68, 68);
  }

  #blabbr-version-history-dropdown {
    position: relative;
    display: inline-block;
  }

  #blabbr-version-history-dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    padding: 12px 16px;
    z-index: 1;
  }

  #blabbr-version-history-dropdown:hover #blabbr-version-history-dropdown-content {
    display: block;
  }
</style>
