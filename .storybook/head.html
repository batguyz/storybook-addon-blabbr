<div id="blabbr-version-history">
  <div class="dropdown">
    <button class="dropbtn" id="blabbr-version-history-dropbtn">Versions</button>
    <div class="dropdown-content" id="blabbr-version-history-dropdown-content">
    </div>
  </div>
</div>

<script>
const processVersions = data => {
  const path = window.parent.location.pathname;
  const currentVersion = path.substr(1, path.length - 2);
  const url = window.parent.location;
  const versionHistoryLinks = document.getElementById('blabbr-version-history-dropdown-content');

  // Assuming that the version numbers are appended to the bottom of the list...
  data.reverse().forEach((version) => {
    if (version === currentVersion) {
      const dropbtn = document.getElementById('blabbr-version-history-dropbtn');
      dropbtn.value = version;
    } else {
      // Link
      const link = document.createElement('a');

      link.href = `${url.protocol}//${url.hostname}:${url.port}/${version}/${url.search}${url.hash}`;
      link.target = '_parent';
      link.appendChild(document.createTextNode(version));

      versionHistoryLinks.appendChild(link);
    }
  });
}

const getVersions = () => {
  const url = window.parent.location;
  const location = `${url.protocol}//${url.hostname}:${url.port}/versions.json`;

  fetch(location).then(response => {
    if (response.ok) {
      response.json().then(data => processVersions(data));
    }
  }).catch(() => {
    // Ignore. Maybe we want to remove the div?
  });
}

getVersions();
</script>
<style>
  html, body {
    padding: 0;
    margin: 0;
  }

  #blabbr-version-history {
    background: rgb(247, 247, 247);
    border-bottom: 1px solid rgb(236, 236, 236);
    padding: 2px 0.5em;
    color: rgb(68, 68, 68);
    font-family: -apple-system, ".SFNSText-Regular", "San Francisco",
      Roboto, "Segoe UI", "Helvetica Neue", "Lucida Grande", sans-serif;
    font-size: 15px;
  }

  #blabbr-version-history .dropbtn {
    /*background-color: #4CAF50;
    color: white;
    padding: 16px;
    font-size: 16px;
    border: none;*/
    cursor: pointer;
    padding: 0.3em;
    border: 1px solid rgb(236, 236, 236);
    background: rgb(255, 255, 255);
    margin: 0 0.5em 0 0;
    color: rgb(68, 68, 68);
  }

  /* The container <div> - needed to position the dropdown content */
  #blabbr-version-history .dropdown {
    position: relative;
    display: inline-block;
  }

  /* Dropdown Content (Hidden by Default) */
  #blabbr-version-history .dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
  }

  /* Links inside the dropdown */
  #blabbr-version-history .dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
  }

  /* Change color of dropdown links on hover */
  #blabbr-version-history .dropdown-content a:hover {background-color: #f1f1f1}

  /* Show the dropdown menu on hover */
  #blabbr-version-history .dropdown:hover .dropdown-content {
    display: block;
  }

  /* Change the background color of the dropdown button when the dropdown content is shown */
  #blabbr-version-history .dropdown:hover .dropbtn {
    color: rgb(247, 247, 247);
    background: rgb(68, 68, 68);
  }
</style>
